{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://meta-framework.io/schemas/feature_flags.schema.json",
    "title": "Feature Flags Schema (L2.5 Meta-Framework)",
    "description": "Validation schema for feature_flags.yml controlling AI sandbox, permissions, and gates.",
    "version": "1.0.0",
  
    "type": "object",
    "required": ["mode", "permissions", "components", "gates"],
  
    "properties": {
      "mode": {
        "type": "object",
        "required": ["cursor_agent_mode", "agentic_write_ops"],
        "properties": {
          "cursor_agent_mode": { "type": "string", "enum": ["sandboxed", "restricted", "autonomous"] },
          "agentic_write_ops": { "type": "boolean" },
          "modify_meta_framework": { "type": "boolean" },
          "human_review_required_for_merge": { "type": "boolean" }
        }
      },
  
      "permissions": {
        "type": "object",
        "properties": {
          "write_to": { "type": "array", "items": { "type": "string" } },
          "readonly": { "type": "array", "items": { "type": "string" } }
        }
      },
  
      "components": {
        "type": "object",
        "patternProperties": {
          "^(frontend|backend|shared|docs)$": {
            "type": "object",
            "properties": {
              "language": { "type": "string" },
              "package_manager": { 
                "type": "string",
                "enum": ["auto", "npm", "yarn", "pnpm", "pip", "poetry"]
              },
              "coverage_threshold": { "type": "integer", "minimum": 0, "maximum": 100 },
              "complexity_limit": { "type": "integer", "minimum": 1 },
              "directories": { "type": "array", "items": { "type": "string" } }
            }
          }
        }
      },
  
      "gates": {
        "type": "object",
        "properties": {
          "block_on_security_critical": { "type": "boolean" },
          "block_on_schema_violation": { "type": "boolean" },
          "block_on_coverage_drop": { "type": "boolean" },
          "warn_on_performance_regression": { "type": "boolean" },
          "warn_on_mutation_drop": { "type": "boolean" }
        }
      },
  
      "thresholds": {
        "type": "object",
        "properties": {
          "coverage": { "type": "integer", "minimum": 0, "maximum": 100 },
          "mutation_kill": { "type": "integer", "minimum": 0, "maximum": 100 },
          "perf_regression_pct": { "type": "integer", "minimum": 0, "maximum": 100 },
          "max_complexity": { "type": "integer", "minimum": 1 }
        }
      },
  
      "ai_guardrails": {
        "type": "object",
        "properties": {
          "enforce_task_scope": { "type": "boolean" },
          "forbid_folder_creation_outside_scope": { "type": "boolean" },
          "enforce_tdd_cycle": { "type": "boolean" },
          "enforce_solid_principles": { "type": "boolean" },
          "require_doc_sync": { "type": "boolean" },
          "require_commit_plan_tags": { "type": "boolean" }
        }
      },
  
      "meta": {
        "type": "object",
        "properties": {
          "schema_version": { "type": "string" },
          "last_updated": { "type": "string", "format": "date-time" },
          "author": { "type": "string" }
        }
      }
    }
  }
  